## 1 流网络的一些概念

> **流网络** $G=(V, E)$ 是一个有向图，图中每条边 $(u, v) \in E$ 有一个非负的**容量值** $c(u, v) \geqslant 0$。而且，如果边集合 E 包含一条边 $(u, v)$，则图中不存在反向边$(v, u)$。如果$(u, v) \notin E$，则为方便起见，定义 $c(u, v) = 0$，并且在图中不允许自循环。
>
> **源结点和汇点**：我们特别分辨出两个特殊结点：**源结点** $s$ 和**汇点** $t$。为了方便起见，假设每个结点都在从源结点到汇点的某条路径上。也就是说，对于每个结点 $v \in V$，流网络都包含一条路径 $s \leadsto v \leadsto t$。因此，**流网络图是连通的**。并且由于除源结点外的每个结点都至少有一条进入的边，我们有 $|E|\geqslant |V|-1$。下图为一个流网络的例子：
>
> ![ASampleOfFlow](../static/image/ASampleOfFlow.png)

**流的形式化定义**

> 设 $G = (V, E)$ 为一个流网络，其容量函数为 $c$。设 $s$ 为网络的源结点，t 为汇点。G 中的**流**是一个实值函数 $f: V\times V \rightarrow R$，满足下面的两条性质：
>
> **容量限制**：对于所有的结点 $u, v \in V$，要求 $0 \leqslant f(u, v) \leqslant c(u, v)$。
>
> **流量守恒**：对于所有的结点 $u\in V-\{s, t\}$，要求
>
> ​							$\sum\limits_{v\in V}f(v,u)=\sum\limits_{v\in V}f(u,v)$ (**此等式可以理解为结点 u 的流入(左)等于流出(右)**)
>
> 当 $(u, v) \notin E$ 时，从结点 $u$ 到结点 $v$ 之间没有流，因此 $f(u, v) = 0$。
>
> **流 f 的值 |f| 的定义**：我们称非负数值 f(u, v) 为从结点 u 到结点 v 的流，一个流 f 的值 |f| 定义如下：
>
> ​							$|f| = \sum\limits_{v\in V}f(s,v)-\sum\limits_{v\in V}f(v,s)$
>
> 也就是说，流 f 的值是从源结点流出的总量减去流入源结点的总量。通常来说，一个流网络不会有任何进入源结点的边，因此，上面公式的 $\sum\limits_{v\in V}f(v,s)$ 将是 0。将其囊括在公式里的原因是后面讨论的残存网络需要考虑流入源结点的流量。

**使用反平行边来模拟问题**

如下图a 所示，如果由于实际原因，需要新增边 $(v_1, v_2)$，但是这违反了流网络的定义。

我们可以新增一个结点 $v‘$，并将边 $(v_1, v_2)$ 分为 $(v_1, v')$ 和 $(v', v_2)$ 两段，且容量都和 $(v_1, v_2)$ 相同，如图b 所示。

![AntiparallelEdges](../static/image/AntiparallelEdges.png)

**具有多个源结点和多个汇点的网络**

一个最大流问题可能有多个源结点和多个汇点，如下图a 所示。

不过可以转换为单个源结点和单个汇点，如图b 所示，方法是加入一个超级源结点 $s$ 和超级汇点 $t$，然后加入有向边 $(s, s_i)，(s_i \in 原源结点集)$ 和有向边 $(t_i, t)，(t_i \in 原汇点集)$。

![MultipleSourcesAndSinks](../static/image/MultipleSourcesAndSinks.png)



## 2 Ford-Fulkerson 方法

> 之所以称 Ford-Fulkerson “方法”，而不是“算法”，是因为它包含了几种运行时间各不相同的具体实现，Ford-Fulkerson 方法依赖于三种重要思想，它们与许多的流算法和问题有关，如残存网络、增广路径和切割。

**残存网络**

给定流网络 $G$，残存网络 $G_f$ 由 $G$ 计算出来。对于 $G$ 中的边 $(u, v)$， 其**残存容量** $c_f(u, v) = c(u, v) - f(u, v)$，如果 $c_f(u, v) > 0$，则在 $G_f$ 中加入一条边 $(u, v)$，容量为 $c_f(u, v)$；另外再加入一条反向边 $(v, u)$，且容量 $c_f(v, u) = f(u, v)$。

更形式化的说，假如有一个流网络 $G=(V,E)$，其源结点为 $s$，汇点为 $t$。设 f 为图 $G$ 中的一个流，考虑结点对 $u，v\in V$，定义残存网络 $c_f(u, v)$ 如下：

​										$c_f(u, v) = \left \{ \begin{array} \\ c(u,v)-f(u,v) & 若(u,v) \in E \\ f(v,u) & 若(v,u) \in E \\ 0 & 其他 \end{array}\right.$

如下图所示，图 b 即由图 a 构造的残存网络

![ResidualNetwork](../static/image/ResidualNetwork.png)

> **递增**
>
> 如果 $f$ 是 $G$ 的一个流，$f'$ 是对应的残存网络 $G_f$ 中的一个流，定义 $f\uparrow f'$ 为流 $f’$ 对流 $f$ 的**递增**
>
> ​		$f\uparrow f'(u, v)=\left\{\begin{array} \\f(u,v)+f'(u,v)-f'(v,u) & 若(u,v)\in E \\ 0 & 其他 \end{array}\right.$
>
> 并且有下面的引理
>
> $|f\uparrow f'|=|f|+|f'|$

**增广路径**

> 给定流网络 $G=(V,E)$ 和流 $f$，增广路径 $p$ 是残存网络 $G_f$ 中一条从源结点 $s$ 到汇点 $t$ 的简单路径。根据残存网络的定义，对于一条增广路径上的边 $(u, v)$，我们可以增加其流量的幅度最大为 $c_f(u, v)$，而不会违反原始流网络 G 中对边 $(u, v)$ 或 $(v, u)$ 的容量限制。
>
> 如上图 b 中阴影覆盖的路径是一条增广路径。如果将图中的残存网络 $G_f$ 看做一个流网络，那么可以对这条路径上每条边的流量增加 4 个单位，而不会违反容量限制，因为该条路径上最小的残存容量是 $c_f(v_2, v_3)=4$。我们称在一条增广路径 $p$ 上能够为每条边增加的流量的最大值为**路径 $p$ 的残存容量**，该容量由下面的表达式给出：
>
> $c_f(p) = \min\{c_f(u,v):(u,v) 属于路径 p\}$
>
> 并且有下面的引理
>
> > 设 $G=(V,E)$ 为一个流网络，设 $f$ 为图 $G$ 中的一个流，设 $p$ 为残存网络 $G_f$ 中的一条增广路径。定义一个函数 $f_p: V\times V \rightarrow R$ 如下：
> >
> > $f_p(u,v)=\left \{ \begin{array} \\ c_f(p) & 若(u,v)在p上 \\ 0 & 其他 \end{array}\right. $
> >
> > 则 $f_p$ 是残存网络 $G_f$ 中的一个流，其值为 $|f_p| = c_f(p) >0$。
> >
> > 如果将流 $f$ 增加 $f_p$ 的量，则将获得 $G$ 的另一个流，该流的值更加接近最大值。
> >
> > 上面的图 c 所描述的是对图 a 的流 $f$ 增加图 b 所示的 $f_p$ 的量所获得的结果，而图 d 描述的则是由图 c 构造的残存网络 $G_f$。